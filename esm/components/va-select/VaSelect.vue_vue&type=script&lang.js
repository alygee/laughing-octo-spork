import{defineComponent as e,ref as t,computed as o,watch as l,nextTick as a}from"vue";import{useSelectableListProps as r,useSelectableList as u}from"../../composables/useSelectableList.js";import{useFormComponentProps as n,useFormComponent as i}from"../../composables/useFormComponent.js";import{useLoadingProps as s}from"../../composables/useLoading.js";import{useColor as p}from"../../composables/useColor.js";import{useMaxSelectionsProps as d,useMaxSelections as c}from"../../composables/useMaxSelections.js";import{warn as v}from"../../services/utils.js";import f from"../va-dropdown/index.js";import m from"../va-icon/index.js";import y from"../va-input/index.js";import g from"./VaSelectOptionList/index.js";import h from"../va-input/VaInputWrapper/index.js";var b=e({name:"VaSelect",components:{VaSelectOptionList:g,VaIcon:m,VaDropdown:f,VaInput:y,VaInputWrapper:h},emits:["update-search","update:modelValue","clear"],props:{...r,...n,...s,...d,modelValue:{type:[String,Number,Object,Array],default:""},position:{type:String,default:"bottom",validator:e=>["top","bottom"].includes(e)},allowCreate:{type:[Boolean,String],default:!1,validator:e=>[!0,!1,"unique"].includes(e)},color:{type:String,default:"primary"},multiple:{type:Boolean,default:!1},searchable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},separator:{type:String,default:", "},width:{type:String,default:"100%"},maxHeight:{type:String,default:"128px"},clearValue:{type:String,default:""},noOptionsText:{type:String,default:"Items not found"},fixed:{type:Boolean,default:!0},clearable:{type:Boolean,default:!1},clearableIcon:{type:String,default:"highlight_off"},hideSelected:{type:Boolean,default:!1},tabindex:{type:Number,default:0},dropdownIcon:{type:[String,Object],default:()=>({open:"expand_more",close:"expand_less"}),validator:e=>{if("string"==typeof e)return!0;const t="string"==typeof e.open,o="string"==typeof e.close;return t&&o}},outline:{type:Boolean,default:!1},bordered:{type:Boolean,default:!1},label:{type:String,default:""},placeholder:{type:String,default:""}},setup(e,r){const n=t(null),s=t(null),d=t(null),{getOptionByValue:f,getValue:m,getText:y,getTrackBy:g}=u(e),{validate:h,isFocused:b,computedErrorMessages:w,computedError:S}=i(e,r),{colorComputed:x}=p(e),C=t(""),O=o((()=>e.searchable||e.allowCreate));l((()=>C.value),(e=>{r.emit("update-search",e),N.value=null}));const V=o({get(){const t=f(e.modelValue);return e.multiple?t?Array.isArray(t)?t:[t]:[]:Array.isArray(t)&&(v("Model value should be a string for a single Select."),t.length)?t[t.length-1]:t},set(e){r.emit("update:modelValue",m(e))}}),A=o((()=>V.value?"string"==typeof V.value?V.value:Array.isArray(V.value)?V.value.map((e=>y(e))).join(e.separator)||e.clearValue:y(V.value):e.clearValue)),I=o((()=>!!e.clearable&&(!e.disabled&&(e.multiple?!!V.value.length:V.value!==e.clearValue)))),j=o((()=>e.dropdownIcon?"string"==typeof e.dropdownIcon?e.dropdownIcon:W.value?e.dropdownIcon.close:e.dropdownIcon.open:"")),B=o((()=>e.options?e.hideSelected?e.options.filter((e=>!k(e))):e.options:[])),k=e=>!!V.value&&(Array.isArray(V.value)?!!V.value.find((t=>L(t,e))):L(V.value,e)),L=(e,t)=>e===t||("string"==typeof e&&"string"==typeof t?e===t:null!==e&&null!==t&&("object"==typeof e&&"object"==typeof t&&g(e)===g(t)));o((()=>e.multiple?null:V.value&&e.options?e.options.find((e=>L(e,V.value))):null));const{exceedsMaxSelections:D,addOption:T}=c(V,t(e.maxSelections),r.emit),E=t=>{if(null!==N.value)if(O.value&&(C.value=""),e.multiple){if(k(t))V.value=V.value.filter((e=>!L(t,e)));else{if(D())return;T(t)}}else V.value="string"==typeof t?t:{...t},G();else G()},M=()=>!(!e.allowCreate||""===C.value),F=()=>{if(e.multiple){if(D())return;const t=V.value.some((e=>e===C.value));"unique"===e.allowCreate&&t||(V.value=[...V.value,C.value])}else V.value=C.value;C.value=""},N=t(null),H=()=>{W.value?E(N.value):P()},W=t(!1),_=o({get:()=>W.value,set:e=>{e?P():R()}}),q=o((()=>!(e.multiple||e.searchable||e.allowCreate))),P=()=>{W.value=!0,Y(),Q()},R=()=>{W.value=!1,h()},U=()=>{W.value?G():P()},z=o((()=>b.value||W.value)),G=()=>{var e;R(),null===(e=n.value)||void 0===e||e.focus()},J=()=>{var e;null===(e=d.value)||void 0===e||e.focus()},K=()=>{var e;null===(e=s.value)||void 0===e||e.focus()},Q=()=>{a((()=>{O.value?J():K()}))},X=o((()=>e.disabled?-1:e.tabindex)),Y=()=>{const e=V.value;if(!e.length&&"object"!=typeof e)return;const t=Array.isArray(e)?e[e.length-1]:e;N.value=t,a((()=>{var e;return null===(e=s.value)||void 0===e?void 0:e.scrollToOption(t)}))};let Z,$="";const ee=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "];return{select:n,optionList:s,focusOptionList:K,focus:()=>{e.disabled||(b.value=!0)},blur:()=>{b.value=!1,h()},reset:()=>{e.multiple?V.value=Array.isArray(e.clearValue)?e.clearValue:[]:V.value=e.clearValue,C.value="",r.emit("clear")},onSelectClick:()=>{e.disabled||U()},hideAndFocus:G,searchBar:d,focusSearchBar:J,searchInput:C,showSearchInput:O,hoveredOption:N,tabIndexComputed:X,valueComputed:V,valueComputedString:A,showClearIcon:I,toggleIcon:j,showDropdownContent:W,computedErrorMessages:w,computedError:S,filteredOptions:B,checkIsOptionSelected:k,closeOnContentClick:q,selectOption:E,selectOrAddOption:()=>{null===N.value?M()&&F():H()},selectHoveredOption:H,hoverPreviousOption:()=>{var e;null===(e=s.value)||void 0===e||e.hoverPreviousOption()},hoverNextOption:()=>{var e;null===(e=s.value)||void 0===e||e.hoverNextOption()},showDropdownContentComputed:_,showDropdown:P,hideDropdown:R,toggleDropdown:U,isFocusedComputed:z,colorComputed:x,onHintedSearch:t=>{if(ee.some((e=>e===t.key)))return;const o=1===t.key.length,l="Backspace"===t.key||"Delete"===t.key;if(clearTimeout(Z),l?$=$?$.slice(0,-1):"":o&&($+=t.key),O.value)C.value=$;else{if($){const t=e.options.find((e=>y(e).toLowerCase().startsWith($.toLowerCase())));t&&(N.value=t)}Z=setTimeout((()=>{$=""}),1e3)}},getText:y,getTrackBy:g}}});export default b;
//# sourceMappingURL=VaSelect.vue_vue&type=script&lang.js.map
