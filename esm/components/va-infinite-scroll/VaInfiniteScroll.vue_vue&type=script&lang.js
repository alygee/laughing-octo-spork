import{__decorate as e}from"tslib";import{debounce as t}from"lodash-es";import{watch as s}from"vue";import{Vue as r,mixins as o,Options as i,prop as l}from"../../node_modules/vue-class-component/dist/vue-class-component.esm-bundler.js";import{sleep as h}from"../../services/utils.js";import n from"../../services/color-config/ColorMixin.js";import{VaProgressCircle as c}from"../va-progress-bar/index.js";const a=r.with(class{constructor(){this.load=l({type:Function,required:!0}),this.offset=l({type:Number,default:500}),this.reverse=l({type:Boolean,default:!1}),this.disabled=l({type:Boolean,default:!1}),this.scrollTarget=l({type:[Object,String],default:null}),this.debounce=l({type:Number,default:100}),this.tag=l({type:String,default:"div"})}});let p=class extends(o(n,a)){constructor(){super(...arguments),this.index=0,this.fetching=!1,this.error=!1,this.initialHeight=null}created(){s((()=>this.$props.disabled),(e=>{e?this.stop():this.resume()})),s((()=>this.$props.debounce),(e=>{this.setDebounce(e)}))}get scrollAmount(){return this.$props.offset+1+this.$el.offsetHeight}get scrollTargetElement(){return"string"==typeof this.$props.scrollTarget?document.querySelector(this.$props.scrollTarget):this.$props.scrollTarget||this.$el.parentElement}get colors(){return{primary:this.theme.getColor("primary","#23e066"),danger:this.theme.getColor("danger","#e34b4a")}}onLoad(){if(this.$props.disabled||this.error||this.fetching)return;const{scrollTop:e,scrollHeight:t}=this.scrollTargetElement,s=this.scrollTargetElement.offsetHeight;(this.$props.reverse?e<this.scrollAmount:e+s+this.scrollAmount>=t)&&(this.fetching=!0,this.scrollTop=this.$props.reverse?0:this.$el.offsetHeight,this.initialHeight=this.$el.offsetHeight,this.$props.load().then(this.finishLoading).catch(this.onError))}onError(){this.stop(),this.error=!0,this.fetching=!0,h(1200).then(this.stopErrorDisplay).then(this.resume)}stopErrorDisplay(){this.scrollTargetElement.scrollTop=this.$props.reverse?this.scrollAmount:this.scrollTargetElement.scrollTop-this.scrollTargetElement.offsetHeight-this.scrollAmount,this.error=!1,this.fetching=!1}finishLoading(){this.fetching=!1,this.$props.reverse&&(this.scrollTargetElement.scrollTop=this.$el.offsetHeight-this.initialHeight)}resume(){this.$props.disabled||this.scrollTargetElement.addEventListener("scroll",this.debouncedLoad,{passive:!0})}stop(){this.$props.disabled||(this.fetching=!1,this.scrollTargetElement.removeEventListener("scroll",this.debouncedLoad,{passive:!0}))}setDebounce(e){this.debouncedLoad=t(this.onLoad,e)}mounted(){this.scrollTargetElement&&(this.scrollTargetElement.style.overflowY="scroll",this.$props.reverse&&(this.scrollTargetElement.scrollTop=this.scrollTargetElement.scrollHeight),this.setDebounce(this.$props.debounce),this.scrollTargetElement.addEventListener("scroll",this.debouncedLoad,{passive:!0}))}beforeUnmount(){this.$props.disabled||this.scrollTargetElement.removeEventListener("scroll",this.debouncedLoad,{passive:!0})}};p=e([i({name:"VaInfiniteScroll",components:{VaProgressCircle:c}})],p);var d=p;export default d;
//# sourceMappingURL=VaInfiniteScroll.vue_vue&type=script&lang.js.map
