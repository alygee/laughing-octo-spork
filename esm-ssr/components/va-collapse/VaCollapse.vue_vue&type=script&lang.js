import{__decorate as t}from"tslib";import{inject as o}from"vue";import{Vue as e,mixins as i,setup as s,Options as n,prop as r}from"../../node_modules/vue-class-component/dist/vue-class-component.esm-bundler.js";import a from"../va-icon/index.js";import l from"../../services/color-config/ColorMixin.js";import{getHoverColor as h}from"../../services/color-config/color-functions.js";import{StatefulMixin as d}from"../../mixins/StatefulMixin/StatefulMixin.js";import u from"../../composables/useKeyboardOnlyFocus.js";import{AccordionServiceKey as c}from"../va-accordion/VaAccordion.vue_vue&type=script&lang.js";const p=e.with(class{constructor(){this.value=r({type:Boolean,default:!1}),this.disabled=r({type:Boolean,default:!1}),this.header=r({type:String,default:""}),this.icon=r({type:String,default:""}),this.solid=r({type:Boolean,default:!1}),this.color=r({type:String,default:""}),this.textColor=r({type:String,default:""}),this.colorAll=r({type:Boolean,default:!1})}});let v=class extends(i(d,l,p)){constructor(){super(...arguments),this.height=0,this.transitionDuration=this.getTransitionDuration(),this.mutationObserver=null,this.valueCollapse={value:void 0},this.accordion=s((()=>o(c,{isInsideAccordion:!1,getProps:()=>{},getState:()=>{},onChildChange:t=>{},onChildMounted:t=>{},onChildUnmounted:t=>{}}))),this.SetupContext=s((()=>{const{hasKeyboardFocus:t,keyboardFocusListeners:o}=u();return{hasKeyboardFocus:t,keyboardFocusListeners:o}}))}get body(){var t;return null===(t=this.$refs)||void 0===t?void 0:t.body}get valueProxy(){return this.accordion.isInsideAccordion?this.valueCollapse.value:this.valueComputed}set valueProxy(t){this.accordion.isInsideAccordion&&(this.valueCollapse.value=t),this.valueComputed=t,this.setCollapseParams()}get computedClasses(){const t=this.accordion.getProps();return{"va-collapse--disabled":this.disabled,"va-collapse--solid":this.solid,"va-collapse--active":this.solid&&this.valueProxy,"va-collapse--popout":(null==t?void 0:t.popout)&&this.valueProxy,"va-collapse--inset":(null==t?void 0:t.inset)&&this.valueProxy}}get contentStyle(){return{paddingLeft:this.icon&&0,color:this.textColor?this.theme.getColor(this.textColor):"",backgroundColor:this.color?this.colorComputed:"",boxShadow:this.SetupContext.hasKeyboardFocus?"0 0 0.5rem 0 rgba(0, 0, 0, 0.3)":""}}get stylesComputed(){var t;return this.valueProxy&&(null===(t=this.$slots.default())||void 0===t?void 0:t[0])?{visibility:"visible",height:this.height+"px",transitionDuration:this.transitionDuration+"s",background:this.color&&this.colorAll?h(this.colorComputed):""}:{visibility:"hidden",height:this.height+"px",transitionDuration:this.transitionDuration+"s"}}get collapseIndexComputed(){return this.disabled?-1:0}changeValue(){this.disabled||(this.valueProxy=!this.valueProxy,this.accordion.onChildChange(this))}getHeight(){var t;if(!this.valueProxy)return 0;return[...(null===(t=this.body)||void 0===t?void 0:t.childNodes)||[]].reduce(((t,o)=>t+=3===o.nodeType?this.getTextNodeHeight(o):o.clientHeight),0)}getTransitionDuration(){const t=this.height/1e3*.2;return t>.2?t:.2}getTextNodeHeight(t){const o=document.createRange();o.selectNodeContents(t);const e=o.getBoundingClientRect();return e.bottom-e.top}setCollapseParams(){this.height=this.getHeight(),this.transitionDuration=this.getTransitionDuration()}mounted(){this.getHeight(),this.mutationObserver=new MutationObserver((()=>{this.setCollapseParams()})),this.mutationObserver.observe(this.body,{attributes:!0,childList:!0,subtree:!0}),this.accordion.isInsideAccordion&&this.accordion.onChildMounted(this)}beforeUnmount(){this.mutationObserver&&this.mutationObserver.disconnect(),this.accordion.isInsideAccordion&&this.accordion.onChildUnmounted(this)}};v=t([n({name:"VaCollapse",components:{VaIcon:a},emits:["focus"]})],v);var m=v;export default m;
//# sourceMappingURL=VaCollapse.vue_vue&type=script&lang.js.map
