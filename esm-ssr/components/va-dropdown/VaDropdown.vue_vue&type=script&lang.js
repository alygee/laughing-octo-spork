import{__decorate as e}from"tslib";import{nextTick as t,watch as o}from"vue";import{Vue as i,mixins as s,Options as n,prop as r}from"../../node_modules/vue-class-component/dist/vue-class-component.esm-bundler.js";import{DebounceLoader as h}from"asva-executors";import{createPopper as p}from"@popperjs/core";import{StatefulMixin as a}from"../../mixins/StatefulMixin/StatefulMixin.js";const d=i.with(class{constructor(){this.debugId=r({type:String,default:""}),this.position=r({type:String,default:""}),this.hoverOverTimeout=r({type:Number,default:30}),this.hoverOutTimeout=r({type:Number,default:200}),this.boundaryBody=r({type:Boolean}),this.modelValue=r({type:Boolean,default:!1}),this.disabled=r({type:Boolean,default:!1}),this.keepAnchorWidth=r({type:Boolean}),this.preventOverflow=r({type:Boolean,default:!1}),this.closeOnContentClick=r({type:Boolean,default:!0}),this.closeOnClickOutside=r({type:Boolean,default:!0}),this.closeOnAnchorClick=r({type:Boolean,default:!0}),this.isContentHoverable=r({type:Boolean,default:!0}),this.offset=r({type:[Array,Number],default:()=>[]}),this.trigger=r({type:String,default:"click",validator:e=>["click","hover","none"].includes(e)}),this.stateful=r({type:Boolean,default:!0})}});let l=class extends(s(a,d)){constructor(){super(...arguments),this.popperInstance=null,this.anchorWidth=0}get anchorWidthStyles(){return{width:this.anchorWidth+"px",maxWidth:this.anchorWidth+"px"}}get classComputed(){return{"va-dropdown--disabled":this.$props.disabled}}get showContent(){return this.valueComputed}handlePopperInstance(){this.popperInstance&&this.removePopper(),this.showContent&&(this.updateAnchorWidth(),t((()=>{this.initPopper()})))}handleClick(e,t){this.$emit(e),t&&this.hide()}onDropdownContentClick(){this.handleClick("dropdown-content-click",this.closeOnContentClick)}onClickOutside(){this.handleClick("click-outside",this.closeOnClickOutside)}onAnchorClick(){if(!this.$props.disabled){if("click"===this.$props.trigger){if(this.valueComputed)return void this.handleClick("anchor-click",this.closeOnAnchorClick);this.valueComputed=!0}this.$emit("anchor-click")}}onMouseOver(){this.$props.disabled||"hover"!==this.$props.trigger||(this.valueComputed||this.hoverOverDebounceLoader.run(),this.hoverOutDebounceLoader.reset())}onMouseOut(){"hover"===this.$props.trigger&&(this.isContentHoverable?this.hoverOutDebounceLoader.run():this.valueComputed=!1,this.hoverOverDebounceLoader.reset())}registerClickOutsideListener(){document.addEventListener("click",(e=>this.handleDocumentClick(e)),!1)}unregisterClickOutsideListener(){document.removeEventListener("click",(e=>this.handleDocumentClick(e)),!1)}handleDocumentClick(e){let t=e.target;const o=[];for(;t;)o.push(t),t=t.parentNode;o.includes(this.$refs.anchor)||o.includes(this.$refs.contentWrapper)||this.showContent&&this.onClickOutside()}updateAnchorWidth(){this.keepAnchorWidth&&(this.anchorWidth=this.$refs.anchor.offsetWidth),this.popperInstance&&this.popperInstance.forceUpdate()}hide(){this.valueComputed=!1}initPopper(){const e={placement:this.position||"bottom",modifiers:[],onFirstUpdate:()=>{this.valueComputed=!0}},t={name:"preventOverflow",options:{}};this.preventOverflow&&e.modifiers.push(t),this.boundaryBody&&(t.options.boundary=document.body),this.offset&&e.modifiers.push({name:"offset",options:{offset:Array.isArray(this.offset)?this.offset:[this.offset]}}),this.popperInstance=p(this.$refs.anchor,this.$refs.contentWrapper,e)}removePopper(){this.valueComputed=!1,this.popperInstance&&(this.popperInstance.destroy(),this.popperInstance=null)}created(){o((()=>this.showContent),(()=>{this.handlePopperInstance()})),this.hoverOverDebounceLoader=new h((async()=>{this.valueComputed=!0}),this.hoverOverTimeout),this.hoverOutDebounceLoader=new h((async()=>{this.valueComputed=!1}),this.hoverOutTimeout),this.$isServer||this.registerClickOutsideListener()}mounted(){this.handlePopperInstance()}beforeUnmount(){this.unregisterClickOutsideListener(),this.removePopper()}};l=e([n({name:"VaDropdown",emits:["update:modelValue","anchor-click","click-outside","dropdown-content-click"]})],l);var c=l;export default c;
//# sourceMappingURL=VaDropdown.vue_vue&type=script&lang.js.map
