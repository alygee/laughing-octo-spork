{"version":3,"file":"VaFileUpload.vue_vue&type=template&id=c04ee272&lang.js","sources":["../../../../src/components/va-file-upload/VaFileUpload.vue?vue&type=template&id=c04ee272&lang.js"],"sourcesContent":["<template>\n  <div\n    class=\"va-file-upload\"\n    :class=\"{'va-file-upload--dropzone': dropzone}\"\n    :style=\"computedStyle\"\n  >\n    <div class=\"va-file-upload__field\">\n      <div\n        class=\"va-file-upload__field__text\"\n        v-if=\"dropzone\"\n      >\n        Drag’n’drop files or\n      </div>\n      <va-button\n        class=\"va-file-upload__field__button\"\n        :disabled=\"disabled\"\n        :color=\"colorComputed\"\n        @click=\"callFileDialogue()\"\n        icon=\"\"\n        icon-right=\"\"\n      >\n        Upload file\n      </va-button>\n      <input\n        ref=\"fileInput\"\n        type=\"file\"\n        class=\"va-file-upload__field__input\"\n        :accept=\"fileTypes\"\n        :multiple=\"type !== 'single'\"\n        :disabled=\"disabled\"\n        @change=\"changeFieldValue\"\n      >\n    </div>\n    <va-file-upload-list\n      v-if=\"files.length\"\n      :type=\"type\"\n      :files=\"files\"\n      :color=\"colorComputed\"\n      @remove=\"removeFile\"\n      @removeSingle=\"removeSingleFile\"\n    />\n    <va-modal\n      v-model=\"modal\"\n      hide-default-actions\n      title=\"File validation\"\n      message=\"File type is incorrect!\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { Options, prop, mixins, Vue } from 'vue-class-component'\n\nimport ColorMixin from '../../services/color-config/ColorMixin'\nimport { shiftHSLAColor } from '../../services/color-config/color-functions'\nimport VaButton from '../va-button'\nimport VaModal from '../va-modal'\n\nimport VaFileUploadList from './VaFileUploadList'\n\nclass FileUploadProps {\n  type = prop<string>({\n    type: String,\n    default: 'list',\n    validator (modelValue: string) {\n      return ['list', 'gallery', 'single'].includes(modelValue)\n    },\n  })\n\n  fileTypes = prop<string>({ type: String, default: '' })\n  dropzone = prop<boolean>({ type: Boolean, default: false })\n  modelValue = prop<any[]>({ type: Array, default: () => [] })\n  color = prop<string>({ type: String, default: 'primary' })\n  disabled = prop<boolean>({ type: Boolean, default: false })\n}\n\nconst FileUploadPropsMixin = Vue.with(FileUploadProps)\n\n@Options({\n  name: 'VaFileUpload',\n  components: {\n    VaModal,\n    VaButton,\n    VaFileUploadList,\n  },\n  emits: ['update:modelValue'],\n})\nexport default class VaFileUpload extends mixins(\n  ColorMixin,\n  FileUploadPropsMixin,\n) {\n  modal = false\n\n  get computedStyle () {\n    return {\n      backgroundColor: this.dropzone ? shiftHSLAColor(this.colorComputed, { a: -0.92 }) : 'transparent',\n    }\n  }\n\n  get files () {\n    return this.modelValue\n  }\n\n  set files (files) {\n    this.$emit('update:modelValue', files)\n  }\n\n  changeFieldValue (e: Event) {\n    this.uploadFile(e)\n    ;(this as any).$refs.fileInput.value = ''\n  }\n\n  uploadFile (e: any) {\n    let files = e.target.files || e.dataTransfer.files\n\n    // type validation\n    if (this.fileTypes) {\n      files = this.validateFiles(Array.from(files))\n    }\n    this.files = [...this.files, ...files]\n  }\n\n  removeFile (index: number) {\n    this.files.splice(index, 1)\n  }\n\n  removeSingleFile () {\n    this.files = []\n  }\n\n  validateFiles (files: any) {\n    return files.filter((file: any) => {\n      const fileName = file.name || file.url\n      if (!fileName) {\n        return false\n      } else {\n        if (file.url) {\n          return true\n        } else {\n          const MIMETypes = ['audio/*', 'video/*', 'image/*']\n          const isContainedMIMEType = MIMETypes.find((t) => this.fileTypes.includes(t))\n\n          if (isContainedMIMEType) {\n            // Do not validatie MIMEType becouse there is too much to validate.\n            return true\n          }\n\n          const extn = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase()\n\n          const isCorrectExt = this.fileTypes.includes(extn)\n          if (!isCorrectExt) {\n            this.modal = true\n          }\n\n          return isCorrectExt\n        }\n      }\n    })\n  }\n\n  callFileDialogue () {\n    // HACK Seems like safari fix. If you happen to stumble upon this and have mac - please test.\n    (this as any).$refs.fileInput.click()\n  }\n\n  mounted () {\n    this.files = this.validateFiles(this.files)\n  }\n}\n</script>\n\n<style lang='scss'>\n@import '../../styles/resources/resources';\n@import 'variables';\n\n.va-file-upload {\n  position: var(--va-file-upload-position);\n\n  &--dropzone {\n    background-color: var(--va-file-upload-dropzone-background-color);\n    padding: var(--va-file-upload-dropzone-padding);\n    overflow: var(--va-file-upload-dropzone-overflow);\n    border-radius: var(--va-file-upload-dropzone-border-radius);\n    cursor: var(--va-file-upload-dropzone-cursor);\n\n    .va-file-upload__field {\n      justify-content: center;\n      display: flex;\n      align-items: center;\n      padding: 0 2rem 1rem;\n      transition: height 0.2s;\n      overflow: visible;\n      flex-wrap: wrap;\n\n      @include media-breakpoint-down(xs) {\n        flex-direction: column;\n        padding: 0 0 1rem;\n\n        &__text {\n          text-align: center;\n        }\n      }\n    }\n\n    .va-file-upload-list {\n      padding-bottom: 1rem;\n    }\n  }\n\n  &__field {\n    padding-bottom: var(--va-file-upload-dropzone-field-padding-bottom);\n    overflow: var(--va-file-upload-dropzone-field-overflow);\n    display: var(--va-file-upload-dropzone-field-display);\n    align-items: var(--va-file-upload-dropzone-field-align-items);\n    position: var(--va-file-upload-dropzone-field-position);\n\n    &__button {\n      margin: var(--va-file-upload-dropzone-field-button-margin);\n      z-index: var(--va-file-upload-dropzone-field-button-zindex);\n    }\n\n    &__text {\n      padding-right: var(--va-file-upload-dropzone-field-text-pr);\n    }\n\n    &__input {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      width: 100%;\n      color: transparent;\n      opacity: 0;\n      cursor: pointer;\n\n      &::-webkit-file-upload-button {\n        cursor: pointer;\n      }\n    }\n  }\n}\n\n@include media-breakpoint-down(xs) {\n  .va-file-upload {\n    &--dropzone {\n      padding: 1.5rem 1rem;\n    }\n  }\n}\n</style>\n"],"names":["_mergeProps","class","_ctx","style","disabled","color","icon","length","type","files","title","message"],"mappings":"2RACEA,GACEC,OAAM,6CAC+BC,aACpCC,MAAOD,4DAKEA,gHAKND,MAAM,gCACLG,SAAUF,WACVG,MAAOH,gBAERI,KAAK,GACL,aAAW,gBANb,0IAcG,SAAQJ,0BACEA,wBACAA,EAAQ,kCAKfA,QAAMK,cACXC,KAAMN,OACNO,MAAOP,QACPG,MAAOH,+DAKCA,iCAAAA,UACT,uBAAA,GACAQ,MAAM,kBACNC,QAAQ"}