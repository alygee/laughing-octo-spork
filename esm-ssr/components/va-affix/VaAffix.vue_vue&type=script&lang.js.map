{"version":3,"file":"VaAffix.vue_vue&type=script&lang.js","sources":["../../../../src/components/va-affix/VaAffix.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"element\"\n    class=\"va-affix\"\n  >\n    <div :style=\"{ visibility: isAffixed ? 'hidden' : 'inherit' }\">\n      <slot />\n    </div>\n    <div\n      v-if=\"isAffixed\"\n      :class=\"computedClass\"\n      :style=\"computedStyle\"\n    >\n      <slot />\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { noop } from 'lodash-es'\nimport { Options, prop, mixins, Vue } from 'vue-class-component'\n\nimport {\n  handleThrottledEvent,\n  useEventsHandlerWithThrottle,\n  getWindowHeight,\n  State, Context,\n} from './VaAffix-utils'\n\nclass AffixProps {\n  offsetTop = prop<number>({ type: Number, default: undefined })\n  offsetBottom = prop<number>({ type: Number, default: undefined })\n  target = prop({ type: Function, default: () => () => window })\n}\n\nconst AffixPropsMixin = Vue.with(AffixProps)\n\n@Options({\n  name: 'VaAffix',\n  emits: ['change'],\n})\nexport default class VaAffix extends mixins(\n  AffixPropsMixin,\n) {\n  private state: State = {\n    isTopAffixed: false,\n    isBottomAffixed: false,\n  }\n\n  private initialPosition?: undefined | DOMRect\n  private clearEventListeners = noop\n\n  get computedClass () {\n    return [\n      {\n        'va-affix--affixed': this.isAffixed,\n      },\n    ]\n  }\n\n  getTargetElement () {\n    // a custom target may get rendered later than\n    // a component gets a property from the context\n    const { target } = this\n    return target()\n  }\n\n  get computedStyle () {\n    const calculateTop = () => {\n      const target = this.getTargetElement()\n\n      if (this.offsetTop === undefined) {\n        return\n      }\n\n      if (target !== window) {\n        const { top } = (target as HTMLElement).getBoundingClientRect()\n        return top + this.offsetTop\n      }\n\n      return this.offsetTop\n    }\n\n    const calculateBottom = () => {\n      const target = this.getTargetElement()\n      if (this.offsetBottom === undefined) {\n        return\n      }\n\n      if (target !== window) {\n        const { bottom } = (target as HTMLElement).getBoundingClientRect()\n        const { offsetHeight, clientHeight } = (target as HTMLElement)\n        const scrollBarHeight = offsetHeight - clientHeight\n        const windowHeight = getWindowHeight()\n        return windowHeight - (bottom - this.offsetBottom) + scrollBarHeight\n      }\n\n      return this.offsetBottom\n    }\n\n    const convertToPixels = (calculate: () => number | undefined) => {\n      const result = calculate()\n\n      if (result === undefined) {\n        return\n      }\n\n      return `${result}px`\n    }\n\n    return {\n      top: this.state.isTopAffixed ? convertToPixels(calculateTop) : null,\n      bottom: this.state.isBottomAffixed ? convertToPixels(calculateBottom) : null,\n      width: `${this.state.width}px`,\n    }\n  }\n\n  get isAffixed (): boolean {\n    return this.state.isTopAffixed || this.state.isBottomAffixed\n  }\n\n  handleThrottledEvent (eventName: string | null, event?: Event) {\n    const context: Context = {\n      ...this.$data,\n      ...this.$props,\n      element: this.$refs.element as any,\n      target: this.getTargetElement(),\n      setState: this.setState.bind(this),\n      getState: this.getState.bind(this),\n    }\n\n    if (!eventName || eventName === 'resize') {\n      handleThrottledEvent(eventName, context)\n    } else if (event && event.target) {\n      const target = this.getTargetElement()\n\n      if ((target as HTMLElement) === event.target || target === window) {\n        handleThrottledEvent(eventName, context)\n      } else {\n        // if we have a custom target but keep scrolling on another element,\n        // so just disable the affixed state\n        this.setState({\n          isBottomAffixed: false,\n          isTopAffixed: false,\n        })\n      }\n    }\n  }\n\n  setState (state: State) {\n    this.state = state\n    this.$emit('change', this.isAffixed)\n  }\n\n  getState () {\n    return this.state\n  }\n\n  mounted () {\n    const events = ['scroll', 'resize']\n\n    this.initialPosition = (this.$refs.element as HTMLElement).getBoundingClientRect()\n\n    this.clearEventListeners = useEventsHandlerWithThrottle(events, {\n      handler: this.handleThrottledEvent,\n    })\n\n    this.$nextTick(() => {\n      // pass `null` here to make sure it is an initial call\n      this.handleThrottledEvent(null)\n    })\n  }\n\n  beforeUnmount () {\n    this.clearEventListeners()\n  }\n}\n</script>\n\n<style lang=\"scss\">\n@import '../../styles/resources/resources';\n@import 'variables';\n\n.va-affix {\n  &--affixed {\n    position: var(--va-affix-affixed-position);\n    z-index: var(--va-affix-affixed-zindex);\n  }\n}\n</style>\n"],"names":["AffixPropsMixin","Vue","with","constructor","this","prop","type","Number","default","undefined","Function","window","VaAffix","mixins","isTopAffixed","isBottomAffixed","noop","computedClass","isAffixed","getTargetElement","target","computedStyle","convertToPixels","calculate","result","top","state","offsetTop","getBoundingClientRect","bottom","offsetBottom","offsetHeight","clientHeight","scrollBarHeight","getWindowHeight","width","handleThrottledEvent","eventName","event","context","$data","$props","element","$refs","setState","bind","getState","$emit","mounted","initialPosition","clearEventListeners","useEventsHandlerWithThrottle","handler","$nextTick","beforeUnmount","Options","name","emits"],"mappings":"6TAkCA,MAAMA,EAAkBC,EAAIC,KAN5B,MAAAC,cACEC,eAAYC,EAAa,CAAEC,KAAMC,OAAQC,aAASC,IAClDL,kBAAeC,EAAa,CAAEC,KAAMC,OAAQC,aAASC,IACrDL,YAASC,EAAK,CAAEC,KAAMI,SAAUF,QAAS,IAAM,IAAMG,YASvD,IAAqBC,EAArB,cAAqCC,EACnCb,IADFG,kCAGUC,WAAe,CACrBU,cAAc,EACdC,iBAAiB,GAIXX,yBAAsBY,EAE9BC,oBACE,MAAO,CACL,CACE,oBAAqBb,KAAKc,YAKhCC,mBAGE,MAAMC,OAAEA,GAAWhB,KACnB,OAAOgB,IAGTC,oBACE,MAgCMC,EAAmBC,IACvB,MAAMC,EAASD,IAEf,QAAed,IAAXe,EAIJ,MAAO,GAAGA,OAGZ,MAAO,CACLC,IAAKrB,KAAKsB,MAAMZ,aAAeQ,GA3CZ,KACnB,MAAMF,EAAShB,KAAKe,mBAEpB,QAAuBV,IAAnBL,KAAKuB,UAAT,CAIA,GAAIP,IAAWT,OAAQ,CACrB,MAAMc,IAAEA,GAASL,EAAuBQ,wBACxC,OAAOH,EAAMrB,KAAKuB,UAGpB,OAAOvB,KAAKuB,cA+BmD,KAC/DE,OAAQzB,KAAKsB,MAAMX,gBAAkBO,GA7Bf,KACtB,MAAMF,EAAShB,KAAKe,mBACpB,QAA0BV,IAAtBL,KAAK0B,aAAT,CAIA,GAAIV,IAAWT,OAAQ,CACrB,MAAMkB,OAAEA,GAAYT,EAAuBQ,yBACrCG,aAAEA,EAAYC,aAAEA,GAAkBZ,EAClCa,EAAkBF,EAAeC,EAEvC,OADqBE,KACEL,EAASzB,KAAK0B,cAAgBG,EAGvD,OAAO7B,KAAK0B,iBAe4D,KACxEK,MAAO,GAAG/B,KAAKsB,MAAMS,WAIzBjB,gBACE,OAAOd,KAAKsB,MAAMZ,cAAgBV,KAAKsB,MAAMX,gBAG/CqB,qBAAsBC,EAA0BC,GAC9C,MAAMC,EAAmB,IACpBnC,KAAKoC,SACLpC,KAAKqC,OACRC,QAAStC,KAAKuC,MAAMD,QACpBtB,OAAQhB,KAAKe,mBACbyB,SAAUxC,KAAKwC,SAASC,KAAKzC,MAC7B0C,SAAU1C,KAAK0C,SAASD,KAAKzC,OAG/B,GAAKiC,GAA2B,WAAdA,GAEX,GAAIC,GAASA,EAAMlB,OAAQ,CAChC,MAAMA,EAAShB,KAAKe,mBAEfC,IAA2BkB,EAAMlB,QAAUA,IAAWT,OACzDyB,EAAqBC,EAAWE,GAIhCnC,KAAKwC,SAAS,CACZ7B,iBAAiB,EACjBD,cAAc,UAXlBsB,EAAqBC,EAAWE,GAiBpCK,SAAUlB,GACRtB,KAAKsB,MAAQA,EACbtB,KAAK2C,MAAM,SAAU3C,KAAKc,WAG5B4B,WACE,OAAO1C,KAAKsB,MAGdsB,UAGE5C,KAAK6C,gBAAmB7C,KAAKuC,MAAMD,QAAwBd,wBAE3DxB,KAAK8C,oBAAsBC,EAJZ,CAAC,SAAU,UAIsC,CAC9DC,QAAShD,KAAKgC,uBAGhBhC,KAAKiD,WAAU,KAEbjD,KAAKgC,qBAAqB,SAI9BkB,gBACElD,KAAK8C,wBArIYtC,KAJpB2C,EAAQ,CACPC,KAAM,UACNC,MAAO,CAAC,aAEW7C,SAAAA"}