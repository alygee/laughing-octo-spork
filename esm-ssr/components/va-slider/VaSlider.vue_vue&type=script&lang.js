import{__decorate as t,__metadata as e}from"tslib";import{watch as i}from"vue";import{Vue as s,mixins as o,setup as n,Options as h,prop as r}from"../../node_modules/vue-class-component/dist/vue-class-component.esm-bundler.js";import{Ref as l}from"../../utils/decorators.js";import a from"../../services/color-config/ColorMixin.js";import{getHoverColor as d}from"../../services/color-config/color-functions.js";import{validateSlider as u}from"./validateSlider.js";import c from"../va-icon/index.js";const m=s.with(class{constructor(){this.range=r({type:Boolean,default:!1}),this.modelValue=r({type:[Number,Array],default:()=>[]}),this.trackLabel=r({type:String,default:""}),this.color=r({type:String,default:"primary"}),this.trackColor=r({type:String,default:""}),this.labelColor=r({type:String,default:""}),this.trackLabelVisible=r({type:Boolean,default:!1}),this.min=r({type:Number,default:0}),this.max=r({type:Number,default:100}),this.step=r({type:Number,default:1}),this.label=r({type:String,default:""}),this.invertLabel=r({type:Boolean,default:!1}),this.disabled=r({type:Boolean,default:!1}),this.readonly=r({type:Boolean,default:!1}),this.pins=r({type:Boolean,default:!1}),this.iconPrepend=r({type:String,default:""}),this.iconAppend=r({type:String,default:""}),this.vertical=r({type:Boolean,default:!1}),this.showTrack=r({type:Boolean,default:!0})}});let v=class extends(o(a,m)){constructor(){super(...arguments),this.isFocused=!1,this.flag=!1,this.size=0,this.currentValue=this.modelValue,this.currentSliderDotIndex=0,this.isComponentExists=!1,this.hasMouseDown=!1,this.context=n((()=>(i([()=>this.val,()=>this.$props.step,()=>this.$props.min,()=>this.$props.max],(([t,e,i,s])=>{u(t,e,i,s)})),i((()=>this.hasMouseDown),(t=>{document.documentElement.style.cursor=t?"grabbing":""})),{})))}get pinPositionStyle(){return this.vertical?"bottom":"left"}get trackSizeStyle(){return this.vertical?"height":"width"}get moreToLess(){return this.val[1]-this.step<this.val[0]}get lessToMore(){return this.val[0]+this.step>this.val[1]}get sliderClass(){return{"va-slider--active":this.isFocused,"va-slider--disabled":this.disabled,"va-slider--readonly":this.readonly,"va-slider--horizontal":!this.vertical,"va-slider--vertical":this.vertical}}get dotClass(){return this.range?[{"va-slider__handler--inactive":!this.isFocused},{"va-slider__handler--inactive":!this.isFocused}]:{"va-slider__handler--on-focus":!this.range&&(this.flag||this.isFocused),"va-slider__handler--inactive":!this.isFocused}}get labelStyles(){return{color:this.labelColor?this.computeColor(this.labelColor):this.colorComputed}}get trackStyles(){return{backgroundColor:this.trackColor?this.computeColor(this.trackColor):d(this.colorComputed)}}get processedStyles(){const t=this.limitValue(this.modelValue);if(this.range){const e=(t[0]-this.min)/(this.max-this.min)*100,i=(t[1]-this.min)/(this.max-this.min)*100;return{[this.pinPositionStyle]:`${e}%`,[this.trackSizeStyle]:i-e+"%",backgroundColor:this.colorComputed,visibility:this.showTrack?"visible":"hidden"}}{const e=(t-this.min)/(this.max-this.min)*100;return{[this.trackSizeStyle]:`${e}%`,backgroundColor:this.colorComputed,visibility:this.showTrack?"visible":"hidden"}}}get dottedStyles(){const t=this.limitValue(this.modelValue);if(this.range){const e=(t[0]-this.min)/(this.max-this.min)*100,i=(t[1]-this.min)/(this.max-this.min)*100;return[{[this.pinPositionStyle]:`${e}%`,backgroundColor:this.isActiveDot(0)?this.colorComputed:"#ffffff",borderColor:this.colorComputed},{[this.pinPositionStyle]:`${i}%`,backgroundColor:this.isActiveDot(1)?this.colorComputed:"#ffffff",borderColor:this.colorComputed}]}{const e=(t-this.min)/(this.max-this.min)*100;return{[this.pinPositionStyle]:`${e}%`,backgroundColor:this.isActiveDot(0)?this.colorComputed:"#ffffff",borderColor:this.colorComputed}}}get val(){return this.$props.modelValue}set val(t){this.range||(t=this.limitValue(t)),this.flag||this.$emit("change",t),this.$emit("update:modelValue",t)}get total(){return(this.max-this.min)/this.step}get gap(){return this.size/this.total}get multiple(){const t=`${this.step}`.split(".")[1];return t?Math.pow(10,t.length):1}get interval(){return this.modelValue[1]-this.modelValue[0]}get pinsCol(){return this.max/this.step-1}get position(){return this.isRange?[(this.modelValue[0]-this.min)/this.step*this.gap,(this.modelValue[1]-this.min)/this.step*this.gap]:(this.modelValue-this.min)/this.step*this.gap}get limit(){return[0,this.size]}get valueLimit(){return[this.min,this.max]}get isRange(){return Array.isArray(this.modelValue)}get propsForValidation(){return{value:this.val,step:this.step,min:this.min,max:this.max}}bindEvents(){document.addEventListener("mousemove",this.moving),document.addEventListener("touchmove",this.moving),document.addEventListener("mouseup",this.moveEnd),document.addEventListener("mouseleave",this.moveEnd),document.addEventListener("touchcancel",this.moveEnd),document.addEventListener("touchend",this.moveEnd),document.addEventListener("keydown",this.moveWithKeys)}unbindEvents(){document.removeEventListener("mousemove",this.moving),document.removeEventListener("touchmove",this.moving),document.removeEventListener("mouseup",this.moveEnd),document.removeEventListener("mouseleave",this.moveEnd),document.removeEventListener("touchcancel",this.moveEnd),document.removeEventListener("touchend",this.moveEnd),document.removeEventListener("keydown",this.moveWithKeys)}isActiveDot(t){return!(!this.isFocused&&!this.flag||this.disabled||this.readonly)&&(this.range?this.currentSliderDotIndex===t:0===this.currentSliderDotIndex)}setMouseDown(t,e=this.currentSliderDotIndex){this.readonly||this.disabled||(this.hasMouseDown=Boolean(e)||!0)}moveStart(t,e=this.currentSliderDotIndex){if(!e)if(this.range){e=this.getPos(t)>(this.position[1]-this.position[0])/2+this.position[0]?1:0}else e=0;this.isRange&&(this.currentSliderDotIndex=e),this.flag=!0,this.$emit("drag-start")}moving(t){if(this.hasMouseDown&&!this.disabled&&!this.readonly){if(!this.flag)return!1;"touchmove"===t.type?this.setValueOnPos(this.getPos(t.touches[0])):(t.preventDefault(),this.setValueOnPos(this.getPos(t)))}}moveEnd(){if(!this.disabled&&!this.readonly){if(!this.flag)return!1;this.$emit("drag-end"),this.$emit("change",this.range?Array.from(this.modelValue):this.modelValue),this.flag=!1,this.hasMouseDown=!1}}moveWithKeys(t){if(![this.dot0,this.dot1,this.dot].includes(document.activeElement))return;if(this.disabled||this.readonly)return;const e=(t,e,i)=>{if(t){if(!this.pins)return this.val.splice(i,1,this.val[i]+(e?this.step:-this.step));const t=(this.max-this.min)/(this.pinsCol+1);let s=(this.val[i]/t|0)*t;this.val[i]!==s?(s+=e?t:0,this.val.splice(i,1,s)):this.val.splice(i,1,this.val[i]+(e?this.step:-this.step))}else{if(!this.pins)return void(this.val+=e?this.step:-this.step);const t=(this.max-this.min)/(this.pinsCol+1);let i=(this.val/t|0)*t;this.val!==i?(i+=e?t:0,this.val=i):this.val+=e?this.step:-this.step}},i=[37,38,39,40],[s,o,n,h]=i;if(-1!==i.indexOf(t.keyCode)&&t.preventDefault(),this.range){const i=t=>this.vertical&&this.dot0===document.activeElement&&t.keyCode===o,r=t=>this.vertical&&this.dot0===document.activeElement&&t.keyCode===h,l=t=>this.vertical&&this.dot1===document.activeElement&&t.keyCode===o,a=t=>this.vertical&&this.dot1===document.activeElement&&t.keyCode===h,d=t=>!this.vertical&&this.dot0===document.activeElement&&t.keyCode===s,u=t=>!this.vertical&&this.dot0===document.activeElement&&t.keyCode===n,c=t=>!this.vertical&&this.dot1===document.activeElement&&t.keyCode===s,m=t=>!this.vertical&&this.dot1===document.activeElement&&t.keyCode===n;switch(!0){case(a(t)||c(t))&&this.moreToLess&&this.val[0]!==this.min:this.dot0.focus(),e(!0,0,0);break;case(i(t)||u(t))&&this.lessToMore&&this.val[1]!==this.max:this.dot0.focus(),e(!0,1,1);break;case(r(t)||d(t))&&this.val[0]!==this.min:e(!0,0,0);break;case(l(t)||m(t))&&this.val[1]!==this.max:e(!0,1,1);break;case(a(t)||c(t))&&this.val[1]!==this.min:e(!0,0,1);break;case(i(t)||u(t))&&this.val[0]!==this.max:e(!0,1,0)}}else this.vertical?(t.keyCode===h&&e(!1,0,0),t.keyCode===o&&e(!1,1,0)):(t.keyCode===s&&e(!1,0,0),t.keyCode===n&&e(!1,1,0))}checkActivePin(t){return this.isRange?t*this.step>this.val[0]&&t*this.step<this.val[1]:t*this.step<this.val}getPinStyles(t){return{backgroundColor:this.checkActivePin(t)?this.colorComputed:d(this.colorComputed),[this.pinPositionStyle]:t*this.step+"%",transition:this.hasMouseDown?"none":"background-color .3s ease-out .1s"}}getPos(t){return this.getStaticData(),this.vertical?this.offset-t.clientY:t.clientX-this.offset}getStaticData(){this.sliderContainer&&(this.size=this.sliderContainer[this.vertical?"offsetHeight":"offsetWidth"],this.offset=this.sliderContainer.getBoundingClientRect()[this.pinPositionStyle])}getValueByIndex(t){return(this.step*this.multiple*t+this.min*this.multiple)/this.multiple}setCurrentValue(t){const e=this.currentSliderDotIndex;if(this.isRange)this.isDiff(this.currentValue[e],t)&&(this.currentValue.splice(e,1,t),0===e?(this.val=[this.currentValue.splice(e,1,t)[0],this.modelValue[1]],this.currentValue=[...this.val]):(this.val=[this.modelValue[0],this.currentValue.splice(e,1,t)[0]],this.currentValue=[...this.val]));else{if(t<this.min||t>this.max)return!1;this.isDiff(this.currentValue,t)&&(this.currentValue=t,this.val=t)}}setValueOnPos(t){const e=this.limit,i=this.valueLimit;if((this.isRange?this.currentSliderDotIndex?this.dot1:this.dot0:this.dot).focus(),t>=e[0]&&t<=e[1])if(this.currentSliderDotIndex){t<=this.position[0]&&(this.val[1]=this.val[0],this.currentSliderDotIndex=0);const e=this.getValueByIndex(Math.round(t/this.gap));this.setCurrentValue(e)}else{t>=this.position[1]&&(this.val[0]=this.val[1],this.currentSliderDotIndex=1);const e=this.getValueByIndex(Math.round(t/this.gap));this.setCurrentValue(e)}else t<e[0]?this.setCurrentValue(i[0]):this.setCurrentValue(i[1])}limitValue(t){const e=t=>t<this.min?this.min:t>this.max?this.max:t;if(this.isRange){if(t[0]>=t[1]&&0===this.currentSliderDotIndex){const i=e(t[1]);return[i,i]}if(t[0]>=t[1]&&1===this.currentSliderDotIndex){const i=e(t[0]);return[i,i]}return t.map((t=>e(t)))}return e(t)}isDiff(t,e){return JSON.stringify(t)!==JSON.stringify(e)}clickOnContainer(t){if(this.disabled||this.readonly)return;const e=this.getPos(t);this.isRange&&(this.currentSliderDotIndex=e>(this.position[1]-this.position[0])/2+this.position[0]?1:0),this.setMouseDown(t,this.currentSliderDotIndex),this.setValueOnPos(e),this.moveStart(t,this.currentSliderDotIndex)}mounted(){this.$nextTick((()=>{u(this.modelValue,this.step,this.min,this.max)&&(this.getStaticData(),this.bindEvents())}))}beforeUnmount(){this.unbindEvents()}};t([l("dot"),e("design:type",HTMLElement)],v.prototype,"dot",void 0),t([l("dot0"),e("design:type",HTMLElement)],v.prototype,"dot0",void 0),t([l("dot1"),e("design:type",HTMLElement)],v.prototype,"dot1",void 0),t([l("sliderContainer"),e("design:type",HTMLElement)],v.prototype,"sliderContainer",void 0),v=t([h({name:"VaSlider",components:{VaIcon:c},emits:["drag-start","drag-end","change","update:modelValue"]})],v);var p=v;export default p;
//# sourceMappingURL=VaSlider.vue_vue&type=script&lang.js.map
