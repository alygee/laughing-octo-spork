{"version":3,"file":"SelectableMixin.js","sources":["../../../../src/mixins/SelectableMixin/SelectableMixin.ts"],"sourcesContent":["import { mixins, Options, prop, setup, Vue } from 'vue-class-component'\n\nimport ColorMixin from '../../services/color-config/ColorMixin'\nimport { FormComponentMixin } from '../FormComponent/FormComponentMixin'\nimport { StatefulMixin } from '../StatefulMixin/StatefulMixin'\nimport { LoadingMixin } from '../LoadingMixin/LoadingMixin'\n\nclass Props {\n  arrayValue = prop<string | Record<string, unknown>>({ type: [String, Object], default: '' })\n  label = prop<string>({ type: String, default: '' })\n  leftLabel = prop<boolean>({ type: Boolean, default: false })\n  trueValue = prop({ default: true })\n  falseValue = prop({ default: false })\n  indeterminate = prop<boolean>({ type: Boolean, default: false })\n  indeterminateValue = prop<boolean | any[] | string | Record<string, unknown>>({\n    type: [Boolean, Array, String, Object],\n    default: null,\n  })\n}\n\nconst PropsMixin = Vue.with(Props)\n\n@Options({\n  emits: ['update:modelValue', 'focus', 'blur'],\n})\nexport class SelectableMixin extends mixins(\n  ColorMixin,\n  StatefulMixin,\n  FormComponentMixin,\n  LoadingMixin,\n  PropsMixin,\n) {\n  isSelectableComponent!: boolean\n\n  created () {\n    this.isSelectableComponent = true\n    this.checkDuplicates()\n  }\n\n  get isChecked (): boolean {\n    if (this.modelIsArray) {\n      return this.modelValue && this.modelValue.includes(this.arrayValue)\n    }\n    return this.valueComputed === this.trueValue\n  }\n\n  get isIndeterminate (): boolean {\n    return this.valueComputed === this.indeterminateValue\n  }\n\n  get modelIsArray (): boolean {\n    return !!this.arrayValue\n  }\n\n  /** @public */\n  reset (): void {\n    this.$emit('update:modelValue', false)\n  }\n\n  checkDuplicates (): void {\n    // Just validating state values.\n    const values: any[] = [this.falseValue, this.trueValue]\n    if (this.indeterminate) {\n      values.push(this.indeterminateValue)\n    }\n    const hasDuplicates = new Set(values).size !== values.length\n    if (hasDuplicates) {\n      throw new Error('falseValue, trueValue, indeterminateValue props should have strictly different values, which is not the case.')\n    }\n  }\n\n  onFocus (event: FocusEvent): void {\n    this.$emit('focus', event)\n  }\n\n  onBlur (event: FocusEvent): void {\n    if (this.$refs.input === event.target && !this.isElementRelated(event.relatedTarget)) {\n      this.ValidateMixin_onBlur()\n      this.$emit('blur', event)\n    }\n  }\n\n  isElementRelated (element: any): boolean {\n    return [this.$refs.label, this.$refs.container].includes(element)\n  }\n\n  onWrapperClick (): void {\n    this.toggleSelection()\n  }\n\n  toggleSelection (): void {\n    if (this.readonly || this.disabled || this.loading) {\n      return\n    }\n    // For array access we pretend computedValue does not exist and use modelValue + emit input directly.\n    if (this.modelIsArray) {\n      if (!this.modelValue) {\n        this.$emit('update:modelValue', [this.arrayValue])\n      } else if (this.modelValue.includes(this.arrayValue)) {\n        this.$emit('update:modelValue', this.modelValue.filter((option: any) => option !== this.arrayValue))\n      } else {\n        this.$emit('update:modelValue', this.modelValue.concat(this.arrayValue))\n      }\n      return\n    }\n\n    if (this.indeterminate) {\n      if (this.isIndeterminate) {\n        this.valueComputed = this.trueValue\n      } else if (this.isChecked) {\n        this.valueComputed = this.falseValue\n      } else {\n        // unchecked\n        this.valueComputed = this.indeterminateValue\n      }\n      return\n    }\n\n    if (this.isChecked) {\n      this.valueComputed = this.falseValue\n    } else {\n      this.valueComputed = this.trueValue\n    }\n  }\n}\n"],"names":["PropsMixin","Vue","with","constructor","this","prop","type","String","Object","default","Boolean","Array","SelectableMixin","mixins","ColorMixin","StatefulMixin","FormComponentMixin","LoadingMixin","created","isSelectableComponent","checkDuplicates","isChecked","modelIsArray","modelValue","includes","arrayValue","valueComputed","trueValue","isIndeterminate","indeterminateValue","reset","$emit","values","falseValue","indeterminate","push","Set","size","length","Error","onFocus","event","onBlur","$refs","input","target","isElementRelated","relatedTarget","ValidateMixin_onBlur","element","label","container","onWrapperClick","toggleSelection","readonly","disabled","loading","filter","option","concat","Options","emits"],"mappings":"ibAoBA,MAAMA,EAAaC,EAAIC,KAbvB,MAAAC,cACEC,gBAAaC,EAAuC,CAAEC,KAAM,CAACC,OAAQC,QAASC,QAAS,KACvFL,WAAQC,EAAa,CAAEC,KAAMC,OAAQE,QAAS,KAC9CL,eAAYC,EAAc,CAAEC,KAAMI,QAASD,SAAS,IACpDL,eAAYC,EAAK,CAAEI,SAAS,IAC5BL,gBAAaC,EAAK,CAAEI,SAAS,IAC7BL,mBAAgBC,EAAc,CAAEC,KAAMI,QAASD,SAAS,IACxDL,wBAAqBC,EAAyD,CAC5EC,KAAM,CAACI,QAASC,MAAOJ,OAAQC,QAC/BC,QAAS,cASAG,EAAb,cAAqCC,EACnCC,EACAC,EACAC,EACAC,EACAjB,IAIAkB,UACEd,KAAKe,uBAAwB,EAC7Bf,KAAKgB,kBAGPC,gBACE,OAAIjB,KAAKkB,aACAlB,KAAKmB,YAAcnB,KAAKmB,WAAWC,SAASpB,KAAKqB,YAEnDrB,KAAKsB,gBAAkBtB,KAAKuB,UAGrCC,sBACE,OAAOxB,KAAKsB,gBAAkBtB,KAAKyB,mBAGrCP,mBACE,QAASlB,KAAKqB,WAIhBK,QACE1B,KAAK2B,MAAM,qBAAqB,GAGlCX,kBAEE,MAAMY,EAAgB,CAAC5B,KAAK6B,WAAY7B,KAAKuB,WACzCvB,KAAK8B,eACPF,EAAOG,KAAK/B,KAAKyB,oBAGnB,GADsB,IAAIO,IAAIJ,GAAQK,OAASL,EAAOM,OAEpD,MAAM,IAAIC,MAAM,iHAIpBC,QAASC,GACPrC,KAAK2B,MAAM,QAASU,GAGtBC,OAAQD,GACFrC,KAAKuC,MAAMC,QAAUH,EAAMI,QAAWzC,KAAK0C,iBAAiBL,EAAMM,iBACpE3C,KAAK4C,uBACL5C,KAAK2B,MAAM,OAAQU,IAIvBK,iBAAkBG,GAChB,MAAO,CAAC7C,KAAKuC,MAAMO,MAAO9C,KAAKuC,MAAMQ,WAAW3B,SAASyB,GAG3DG,iBACEhD,KAAKiD,kBAGPA,kBACMjD,KAAKkD,UAAYlD,KAAKmD,UAAYnD,KAAKoD,UAIvCpD,KAAKkB,aACFlB,KAAKmB,WAECnB,KAAKmB,WAAWC,SAASpB,KAAKqB,YACvCrB,KAAK2B,MAAM,oBAAqB3B,KAAKmB,WAAWkC,QAAQC,GAAgBA,IAAWtD,KAAKqB,cAExFrB,KAAK2B,MAAM,oBAAqB3B,KAAKmB,WAAWoC,OAAOvD,KAAKqB,aAJ5DrB,KAAK2B,MAAM,oBAAqB,CAAC3B,KAAKqB,aAStCrB,KAAK8B,cACH9B,KAAKwB,gBACPxB,KAAKsB,cAAgBtB,KAAKuB,UACjBvB,KAAKiB,UACdjB,KAAKsB,cAAgBtB,KAAK6B,WAG1B7B,KAAKsB,cAAgBtB,KAAKyB,mBAK1BzB,KAAKiB,UACPjB,KAAKsB,cAAgBtB,KAAK6B,WAE1B7B,KAAKsB,cAAgBtB,KAAKuB,aAhGnBf,KAHZgD,EAAQ,CACPC,MAAO,CAAC,oBAAqB,QAAS,WAE3BjD"}